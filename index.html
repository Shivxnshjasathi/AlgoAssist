<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0a18;
            /* The main container will handle scrolling, not the body */
        }

        .aurora-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }

        .aurora-background div {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            animation: aurora-animation 20s infinite alternate;
        }

        .aurora-shape1 {
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(167, 139, 250, 0.8) 0%, rgba(167, 139, 250, 0) 70%);
            top: -10%;
            left: -10%;
        }

        .aurora-shape2 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.8) 0%, rgba(99, 102, 241, 0) 70%);
            bottom: -15%;
            right: -5%;
            animation-delay: 5s;
        }
        
        .aurora-shape3 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.6) 0%, rgba(236, 72, 153, 0) 70%);
            top: 20%;
            right: 20%;
            animation-delay: 10s;
        }

        @keyframes aurora-animation {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(100px, 50px) scale(1.2); }
            100% { transform: translate(-50px, -100px) scale(0.9); }
        }

        .glass-container {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden; /* Keep for border-radius and shine effect */
            height: 100%; /* Full height on mobile */
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 640px) {
            .glass-container {
                max-height: 90vh;
                height: auto;
            }
        }


        main#app-content {
            overflow-y: auto; /* Allow this section to scroll */
            flex-grow: 1;
        }

        /* Custom Scrollbar Styling */
        main#app-content::-webkit-scrollbar {
            width: 8px;
        }
        main#app-content::-webkit-scrollbar-track {
            background: transparent;
        }
        main#app-content::-webkit-scrollbar-thumb {
            background-color: rgba(99, 102, 241, 0.5);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        main#app-content::-webkit-scrollbar-thumb:hover {
            background-color: rgba(99, 102, 241, 0.8);
        }

        .shine-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at var(--shine-x) var(--shine-y), rgba(255, 255, 255, 0.1), transparent 40%);
            pointer-events: none;
            transition: opacity 0.2s;
            opacity: 0;
        }

        .glass-container:hover .shine-effect {
            opacity: 1;
        }

        .ai-thinking-dot {
            width: 8px;
            height: 8px;
            background-color: #9CA3AF;
            border-radius: 50%;
            animation: ai-thinking 1.4s infinite ease-in-out both;
        }
        .ai-thinking-dot:nth-child(1) { animation-delay: -0.32s; }
        .ai-thinking-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes ai-thinking {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        #response-container {
            transition: opacity 0.5s ease-in-out;
        }

        /* Styling for Markdown-generated content */
        .markdown-content pre, #code-editor {
            background-color: #0c0a18;
            border: 1px solid #374151;
            border-radius: 0.75rem;
            padding: 1.25rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .markdown-content code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            color: #e5e7eb;
            font-size: 0.95rem;
            background-color: #2d3748;
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
        }
         .markdown-content pre code {
            background-color: transparent;
            padding: 0;
        }
        .markdown-content h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-top: 1.75rem;
            margin-bottom: 1rem;
            color: #c4b5fd;
            border-bottom: 1px solid #4b5563;
            padding-bottom: 0.5rem;
        }
        .markdown-content ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
         .markdown-content li {
            margin-bottom: 0.5rem;
        }
        .markdown-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
            font-size: 1.05rem;
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
        }
        .nav-link.active {
            color: #c4b5fd;
            background-color: rgba(99, 102, 241, 0.2);
        }
    </style>
</head>
<body class="text-gray-200 flex sm:items-center justify-center p-0 sm:p-4">
    <div class="aurora-background">
        <div class="aurora-shape1"></div>
        <div class="aurora-shape2"></div>
        <div class="aurora-shape3"></div>
    </div>

    <div class="w-full max-w-4xl mx-auto h-full sm:h-auto">
        <div class="glass-container rounded-none sm:rounded-3xl shadow-2xl">
            <div class="shine-effect"></div>
            <!-- Navigation -->
            <nav class="p-4 border-b border-white/10 flex-shrink-0">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="p-2 bg-gray-900/50 rounded-full border border-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                        </div>
                        <h1 class="text-xl font-bold text-gray-100 tracking-tight">Codex</h1>
                    </div>
                    <div class="flex space-x-1 sm:space-x-2 bg-gray-900/50 p-1 rounded-full border border-gray-700">
                        <button class="nav-link active px-3 sm:px-4 py-2 rounded-full text-sm font-semibold" data-page="home">Home</button>
                        <button class="nav-link px-3 sm:px-4 py-2 rounded-full text-sm font-semibold" data-page="solver">Solver</button>
                        <button class="nav-link px-3 sm:px-4 py-2 rounded-full text-sm font-semibold" data-page="practice">Practice</button>
                    </div>
                </div>
            </nav>

            <!-- Page Content -->
            <main id="app-content">
                <!-- Home Page (Landing Page) -->
                <div id="home-page" class="p-4 sm:p-6 md:p-10">
                    <div class="text-center">
                        <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold tracking-tight text-white">Your Personal AI Coding Assistant</h2>
                        <p class="mt-4 sm:mt-6 text-base sm:text-lg leading-8 text-gray-300">Stuck on a problem? Get comprehensive, step-by-step solution guides instantly. Understand the logic, explore different approaches, and master data structures and algorithms.</p>
                        <div class="mt-8 sm:mt-10 flex items-center justify-center gap-x-6">
                            <button id="start-solving-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-3 px-6 rounded-xl transition duration-300 ease-in-out transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 shadow-lg shadow-indigo-600/30">
                                Start Solving Now
                            </button>
                        </div>
                    </div>
                    <div class="mt-12 sm:mt-16 grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                        <div class="feature-card p-6 bg-gray-900/30 rounded-2xl border border-white/10">
                            <h3 class="text-lg font-semibold text-indigo-300">Detailed Explanations</h3>
                            <p class="mt-2 text-gray-400">Don't just get the code. Understand the 'why' behind every line with detailed explanations.</p>
                        </div>
                        <div class="feature-card p-6 bg-gray-900/30 rounded-2xl border border-white/10">
                            <h3 class="text-lg font-semibold text-indigo-300">Multiple Approaches</h3>
                            <p class="mt-2 text-gray-400">Explore various ways to tackle a problem, from brute-force to the most optimal solution.</p>
                        </div>
                        <div class="feature-card p-6 bg-gray-900/30 rounded-2xl border border-white/10">
                            <h3 class="text-lg font-semibold text-indigo-300">Multi-Language Support</h3>
                            <p class="mt-2 text-gray-400">Get solutions in your preferred language: Python, JavaScript, Java, or C++.</p>
                        </div>
                    </div>
                </div>

                <!-- Solver Page -->
                <div id="solver-page" class="p-4 sm:p-6 md:p-8 hidden">
                    <div class="space-y-6">
                        <div class="relative">
                            <label for="problem-number-input" class="block text-sm font-medium text-gray-400 mb-2">LeetCode Problem Number</label>
                            <div class="absolute inset-y-0 left-0 top-7 flex items-center pl-4 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><hash class="lucide lucide-hash" /><path d="M4 9h16"/><path d="M4 15h16"/><path d="M9 4v16"/><path d="M15 4v16"/></svg>
                            </div>
                            <input type="text" id="problem-number-input" class="w-full bg-gray-900/70 border border-gray-700 rounded-xl p-4 pl-11 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="e.g., 206">
                        </div>

                        <div class="relative">
                            <label for="language-select" class="block text-sm font-medium text-gray-400 mb-2">Programming Language</label>
                             <div class="absolute inset-y-0 left-0 top-7 flex items-center pl-4 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="5 8 1 12 5 16"></polyline><polyline points="19 8 23 12 19 16"></polyline><line x1="15" x2="9" y1="4" y2="20"></line></svg>
                            </div>
                            <select id="language-select" class="w-full appearance-none bg-gray-900/70 border border-gray-700 rounded-xl p-4 pl-11 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                                <option value="Python">Python</option>
                                <option value="JavaScript">JavaScript</option>
                                <option value="Java">Java</option>
                                <option value="C++">C++</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 top-7 flex items-center pr-4 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" /></svg>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <button id="solve-btn" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-4 px-4 rounded-xl transition duration-300 ease-in-out transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 flex items-center justify-center shadow-lg shadow-indigo-600/30">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                                Get Solution Guide
                            </button>
                            <button id="youtube-btn" class="w-full bg-red-600 hover:bg-red-500 text-white font-semibold py-4 px-4 rounded-xl transition duration-300 ease-in-out transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-red-500 flex items-center justify-center shadow-lg shadow-red-600/30 hidden">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M2.5 17a24.12 24.12 0 0 1 0-10 2 2 0 0 1 1.4-1.4 49.56 49.56 0 0 1 16.2 0A2 2 0 0 1 21.5 7a24.12 24.12 0 0 1 0 10 2 2 0 0 1-1.4 1.4 49.55 49.55 0 0 1-16.2 0A2 2 0 0 1 2.5 17"/><path d="m10 15 5-3-5-3z"/></svg>
                                Watch Video Solution
                            </button>
                        </div>
                    </div>
                     <div id="response-container" class="mt-8 border-t border-white/10 pt-8 hidden opacity-0">
                         <div id="loading-indicator" class="flex items-center space-x-2 hidden">
                            <div class="ai-thinking-dot"></div>
                            <div class="ai-thinking-dot"></div>
                            <div class="ai-thinking-dot"></div>
                            <span class="text-gray-400">AI is generating a full solution guide...</span>
                        </div>
                        <div id="response-header" class="flex justify-between items-center mb-4 hidden">
                            <h3 class="text-lg font-semibold text-gray-300">Solution Guide</h3>
                            <button id="tts-btn" class="flex items-center text-gray-400 hover:text-white transition-colors p-2 rounded-lg bg-gray-900/50 hover:bg-gray-800/70">
                                <svg id="tts-play-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                                <svg id="tts-stop-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><rect x="6" y="6" width="12" height="12"></rect></svg>
                                <span class="ml-2 text-sm font-medium">Read Aloud</span>
                            </button>
                        </div>
                        <div id="ai-response" class="text-gray-300 leading-relaxed max-w-none markdown-content"></div>
                    </div>
                </div>
                
                <!-- Practice Page -->
                <div id="practice-page" class="p-4 sm:p-6 md:p-8 hidden">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h2 class="text-2xl font-bold text-white">Practice Arena</h2>
                        <div class="flex items-center space-x-4 w-full sm:w-auto">
                             <button id="run-code-btn" class="w-full bg-green-600 hover:bg-green-500 text-white font-semibold py-2 px-4 rounded-xl transition duration-300 ease-in-out flex items-center justify-center">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                                 Run Code
                             </button>
                            <button id="suggest-problem-btn" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-xl transition duration-300 ease-in-out flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="m10.4 12.6-1.8 2.4 1.8 2.4"></path><path d="m13.6 17.4 1.8-2.4-1.8-2.4"></path></svg>
                                New Problem
                            </button>
                        </div>
                    </div>

                    <div id="problem-display" class="mb-6 p-6 bg-gray-900/30 rounded-2xl border border-white/10">
                        <div id="problem-loading" class="hidden items-center space-x-2">
                            <div class="ai-thinking-dot"></div>
                            <div class="ai-thinking-dot"></div>
                            <div class="ai-thinking-dot"></div>
                            <span class="text-gray-400">Finding a new problem for you...</span>
                        </div>
                        <div id="problem-content" class="markdown-content">
                            <h3 id="problem-title" class="text-xl font-semibold text-indigo-300">Welcome!</h3>
                            <div id="problem-description" class="mt-2 text-gray-400">Click the "New Problem" button to get a random coding challenge.</div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label for="code-editor" class="block text-sm font-medium text-gray-400 mb-2">Your Solution</label>
                        <textarea id="code-editor" class="w-full h-64 bg-gray-900/70 border border-gray-700 rounded-xl p-4 text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="Write your code here..."></textarea>
                    </div>
                </div>

            </main>
        </div>
        <p class="text-center text-gray-500 text-xs mt-8">Powered by Pollinations.ai</p>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast-notification" class="fixed top-5 right-5 bg-gray-800 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 hidden transition-opacity duration-300">
        <p id="toast-message"></p>
    </div>


    <script>
        // Shine effect logic
        const container = document.querySelector('.glass-container');
        const shine = document.querySelector('.shine-effect');
        container.addEventListener('mousemove', e => {
            const rect = container.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            shine.style.setProperty('--shine-x', `${x}px`);
            shine.style.setProperty('--shine-y', `${y}px`);
        });

        // Page navigation logic
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = {
            home: document.getElementById('home-page'),
            solver: document.getElementById('solver-page'),
            practice: document.getElementById('practice-page')
        };

        function showPage(pageName) {
            Object.values(pages).forEach(page => page.classList.add('hidden'));
            pages[pageName].classList.remove('hidden');

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === pageName) {
                    link.classList.add('active');
                }
            });
             // When switching pages, stop any ongoing speech synthesis
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', () => showPage(link.dataset.page));
        });
        
        document.getElementById('start-solving-btn').addEventListener('click', () => showPage('solver'));

        // Markdown Converter
        const converter = new showdown.Converter();

        // Solver logic
        const solveBtn = document.getElementById('solve-btn');
        const youtubeBtn = document.getElementById('youtube-btn');
        const problemInput = document.getElementById('problem-number-input');
        const languageSelect = document.getElementById('language-select');
        const responseContainer = document.getElementById('response-container');
        const aiResponse = document.getElementById('ai-response');
        const loadingIndicator = document.getElementById('loading-indicator');
        const responseHeader = document.getElementById('response-header');

        // Text-to-Speech elements
        const ttsBtn = document.getElementById('tts-btn');
        const ttsPlayIcon = document.getElementById('tts-play-icon');
        const ttsStopIcon = document.getElementById('tts-stop-icon');
        const ttsBtnText = ttsBtn.querySelector('span');
        let currentUtterance = null; // To hold a reference to the utterance


        async function callLeetCodeAPI(problemNumber, language) {
            const fullPrompt = `Provide a full solution guide for LeetCode problem ${problemNumber} in ${language}. The guide MUST include the following sections with these exact markdown headings: ## Problem Summary, ## Hints, ## Approaches, ## Code Solution and Explanation.`;
            const encodedPrompt = encodeURIComponent(fullPrompt);
            const apiUrl = `https://text.pollinations.ai/${encodedPrompt}`;

            try {
                const response = await fetch(apiUrl);
                if (response.ok) {
                    return await response.text();
                } else {
                    return `Error: Unable to fetch response. Status: ${response.status}`;
                }
            } catch (error) {
                console.error("API call failed:", error);
                return "An error occurred while trying to contact the AI. Please check your network connection and try again.";
            }
        }

        solveBtn.addEventListener('click', async () => {
            const problemNumber = problemInput.value.trim();
            const selectedLanguage = languageSelect.value;

            if (!problemNumber) {
                aiResponse.innerHTML = "<p>Please enter a problem number.</p>";
                responseContainer.classList.remove('hidden');
                responseContainer.style.opacity = 1;
                youtubeBtn.classList.add('hidden');
                responseHeader.classList.add('hidden');
                return;
            }

            // Reset UI for new request
            speechSynthesis.cancel(); // Stop any previous speech
            responseContainer.classList.remove('hidden');
            loadingIndicator.classList.remove('hidden');
            aiResponse.classList.add('hidden');
            youtubeBtn.classList.add('hidden');
            responseHeader.classList.add('hidden');
            solveBtn.disabled = true;
            solveBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            setTimeout(() => {
                responseContainer.style.opacity = 1;
            }, 10);

            const responseText = await callLeetCodeAPI(problemNumber, selectedLanguage);
            
            loadingIndicator.classList.add('hidden');
            aiResponse.innerHTML = converter.makeHtml(responseText);
            aiResponse.classList.remove('hidden');
            
            // Show YouTube button and response header on success
            youtubeBtn.classList.remove('hidden');
            responseHeader.classList.remove('hidden');

            solveBtn.disabled = false;
            solveBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        });

        youtubeBtn.addEventListener('click', () => {
            const problemNumber = problemInput.value.trim();
            if (problemNumber) {
                const youtubeSearchUrl = `https://www.youtube.com/results?search_query=leetcode+${problemNumber}`;
                window.open(youtubeSearchUrl, '_blank');
            }
        });

        ttsBtn.addEventListener('click', () => {
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel(); // This will trigger the 'onend' event handler
                return;
            }

            const textToSpeak = aiResponse.innerText;
            if (textToSpeak && textToSpeak.trim() !== '') {
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                currentUtterance = utterance; // Keep reference to prevent GC issues
                
                utterance.onstart = () => {
                    ttsBtnText.textContent = 'Stop Reading';
                    ttsPlayIcon.classList.add('hidden');
                    ttsStopIcon.classList.remove('hidden');
                };

                utterance.onend = () => {
                    ttsBtnText.textContent = 'Read Aloud';
                    ttsPlayIcon.classList.remove('hidden');
                    ttsStopIcon.classList.add('hidden');
                    currentUtterance = null; // Clear reference
                };
                
                utterance.onerror = (event) => {
                    console.error('An error occurred during speech synthesis:', event.error || 'Unknown error');
                    ttsBtnText.textContent = 'Read Aloud';
                    ttsPlayIcon.classList.remove('hidden');
                    ttsStopIcon.classList.add('hidden');
                    currentUtterance = null; // Clear reference
                };

                speechSynthesis.speak(utterance);
            }
        });

        // Practice Arena Logic
        const suggestProblemBtn = document.getElementById('suggest-problem-btn');
        const problemTitle = document.getElementById('problem-title');
        const problemDescription = document.getElementById('problem-description');
        const codeEditor = document.getElementById('code-editor');
        const runCodeBtn = document.getElementById('run-code-btn');
        const problemLoading = document.getElementById('problem-loading');
        const problemContent = document.getElementById('problem-content');
        const toastEl = document.getElementById('toast-notification');
        const toastMessage = document.getElementById('toast-message');

        let currentProblem = null;

        async function callRandomProblemAPI() {
            const apiUrl = `https://text.pollinations.ai/give%20one%20randoem%20comprtivr%20coding%20quesrion%20with%20text%20cases`;
            try {
                const response = await fetch(apiUrl);
                if (response.ok) {
                    return await response.text();
                }
                return "Error: Could not fetch a random problem.";
            } catch (error) {
                console.error("Random problem API call failed:", error);
                return "Error: Could not fetch a random problem.";
            }
        }

        function parseProblemResponse(text) {
            text = '\n' + text;
            const sections = {};
            const sectionHeaders = {
                title: /\n(?:## |#|\*\*Title:\*\*|\*\*Problem:\*\*|Problem:|Title:)\s*/i,
                description: /\n(?:## |#|\*\*Description:\*\*|\*\*Problem Statement:\*\*|Description:)\s*/i,
                testCases: /\n(?:## |#|\*\*Test Cases:\*\*|\*\*Examples:\*\*|Test Cases:|Examples:|Example:|Input:|Output:)\s*/i,
            };

            const foundHeaders = Object.keys(sectionHeaders)
                .map(key => ({ key, match: text.match(sectionHeaders[key]) }))
                .filter(item => item.match)
                .map(item => ({ key: item.key, index: item.match.index, rawHeader: item.match[0] }))
                .sort((a, b) => a.index - b.index);

            if (foundHeaders.length === 0) {
                return {
                    title: "Could Not Parse Problem",
                    description: text.trim(),
                };
            }

            for (let i = 0; i < foundHeaders.length; i++) {
                const currentHeader = foundHeaders[i];
                const nextHeader = foundHeaders[i + 1];
                const startIndex = currentHeader.index + currentHeader.rawHeader.length;
                const endIndex = nextHeader ? nextHeader.index : text.length;
                sections[currentHeader.key] = text.substring(startIndex, endIndex).trim();
            }

            const fullDescription = (sections.description || '') + '\n\n' + (sections.testCases || '');

            return {
                title: sections.title || 'Title Not Found',
                description: fullDescription.trim(),
            };
        }


        function displayProblem(problem) {
            currentProblem = problem;
            problemTitle.textContent = problem.title;
            problemDescription.innerHTML = converter.makeHtml(problem.description);
            codeEditor.value = '';
        }
        
        function showToast(message) {
            toastMessage.textContent = message;
            toastEl.classList.remove('hidden');
            setTimeout(() => toastEl.classList.remove('opacity-0'), 10); // Fade in
            setTimeout(() => {
                toastEl.classList.add('opacity-0');
                setTimeout(() => toastEl.classList.add('hidden'), 300); // Fade out
            }, 2700);
        }

        suggestProblemBtn.addEventListener('click', async () => {
            problemContent.classList.add('hidden');
            problemLoading.classList.remove('hidden');
            suggestProblemBtn.disabled = true;
            suggestProblemBtn.classList.add('opacity-50');

            const responseText = await callRandomProblemAPI();
            const problem = parseProblemResponse(responseText);
            displayProblem(problem);

            problemLoading.classList.add('hidden');
            problemContent.classList.remove('hidden');
            suggestProblemBtn.disabled = false;
            suggestProblemBtn.classList.remove('opacity-50');
        });

        runCodeBtn.addEventListener('click', () => {
            showToast('Compiling and running... (Simulated)');
        });


        // Show home page by default
        showPage('home');
    </script>
</body>
</html>
